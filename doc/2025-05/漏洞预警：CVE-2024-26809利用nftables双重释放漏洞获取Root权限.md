#  漏洞预警：CVE-2024-26809利用nftables双重释放漏洞获取Root权限   
邑安科技  邑安全   2025-05-12 05:25  
  
更多全球网络安全资讯尽在邑安全  
  
![](https://mmbiz.qpic.cn/mmbiz_png/1N39PtINn8vZYfzeHwtJkOtfpTZuElaODo5DS0aibP431viaD1df2iawZnGHlDGpbqLyBusn3kAwlELkEer36k8Zw/640?wx_fmt=png&from=appmsg "")  
## 漏洞概述  
  
Linux内核的nftables子系统（特别是net/netfilter模块）中发现一个高危漏洞，攻击者可利用nft_pipapo_destroy()函数中的双重释放（double-free）漏洞实现本地提权。该漏洞编号为CVE-2024-26809，影响内核版本6.1-rc1及以上以及5.15.54及以上的系统。  
## 技术原理  
  
该漏洞源于nftables数据包过滤功能中pipapo集合销毁过程的逻辑缺陷。在特定条件下，某个元素可能同时存在于match和clone中，导致函数尝试对同一内存区域执行两次释放操作，从而引发内存损坏。  
  
问题函数关键片段：  
```
static void nft_pipapo_destroy(const struct nft_ctx *ctx, const struct nft_set *set) {
    struct nft_pipapo *priv = nft_set_priv(set);
    struct nft_pipapo_match *m;
    int cpu;
    m = rcu_dereference_protected(priv->match, true);
    if (m) {
        ...
        nft_set_pipapo_match_destroy(ctx, set, m);
        ...
    }
    if (priv->clone) {
        m = priv->clone;
        if (priv->dirty)
            nft_set_pipapo_match_destroy(ctx, set, m);
        ...
```  
  
当dirty标志被设置时，该函数会对重叠的内存区域错误地调用两次nft_set_pipapo_match_destroy()。  
## 利用方式  
  
CVE-2024-26809的利用过程涉及通过内核对象缓存系统（特别是kmalloc-256）进行堆布局和操控。攻击者通过精心设计的内存分配与释放操作实现：  
- 重叠nftables对象  
  
- 泄露内核地址  
  
- 劫持函数指针（如expr->ops->dump）  
  
- 执行ROP（返回导向编程）指令链获取root权限  
  
技术分析指出："完成栈迁移后，我们可以运行ROPgadget并最终获得root shell"。该攻击展示了攻击者对内核内存结构的深入理解，以及如何将细微的内存错误武器化以实现完全系统控制。  
## 修复建议  
  
目前已有可用的概念验证（PoC）漏洞利用代码，演示了如何串联该漏洞实现内核代码执行。受影响内核版本的用户应立即更新系统以应用相关补丁，消除CVE-2024-26809带来的安全风险。  
  
原文来自: securityonline.info  
  
原文链接:   
https://securityonline.info/  
  
欢迎收藏并分享朋友圈，让五邑人网络更安全  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/1N39PtINn8tD9ic928O6vIrMg4fuib48e1TsRj9K9Cz7RZBD2jjVZcKm1N4QrZ4bwBKZic5crOdItOcdDicPd3yBSg/640?wx_fmt=jpeg "")  
  
欢迎扫描关注我们，及时了解最新安全动态、学习最潮流的安全姿势！  
  
推荐文章  
  
1  
  
[新永恒之蓝？微软SMBv3高危漏洞（CVE-2020-0796）分析复现](http://mp.weixin.qq.com/s?__biz=MzUyMzczNzUyNQ==&mid=2247488913&idx=1&sn=acbf595a4a80dcaba647c7a32fe5e06b&chksm=fa39554bcd4edc5dc90019f33746404ab7593dd9d90109b1076a4a73f2be0cb6fa90e8743b50&scene=21#wechat_redirect)  
  
  
2  
  
[重大漏洞预警：ubuntu最新版本存在本地提权漏洞（已有EXP）　](http://mp.weixin.qq.com/s?__biz=MzUyMzczNzUyNQ==&mid=2247483652&idx=1&sn=b2f2ec90db499e23cfa252e9ee743265&chksm=fa3941decd4ec8c83a268c3480c354a621d515262bcbb5f35e1a2dde8c828bdc7b9011cb5072&scene=21#wechat_redirect)  
  
  
  
  
  
